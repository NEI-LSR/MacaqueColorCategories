<!--
PURPOSE:

-->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><!-- You must include this JavaScript file --><!-- <script src="https://assets.crowd.aws/crowd-html-elements.js"></script> --><!--  document.getElementById(form.id).submit() -->

<!-- CSS STYLING -->

<style type="text/css">.trialDiv {
border: 0px solid gray;
padding-top: 0px;
padding-bottom: 0px;
padding-right:0px;
padding-left: 0px;
width: 1000px;
height: 500px;
margin: 0 auto;
display: none;
position: relative;
user-select: none;
-moz-user-select: none;
-moz-user-drag: none;
}

.fixDiv {
border: 0px solid gray;
padding-top: 0px;
padding-bottom: 0px;
padding-right: 0px;
padding-left: 0px;
width: 1000px;
height: 500px;
margin: 0 auto;
display: none;
user-select: none;
-moz-user-select: none;
-moz-user-drag: none;
}

.cueDiv {
border: 0px solid gray;
padding-top: 0px;
padding-bottom: 0px;
padding-right: 0px;
padding-left: 0px;
width: 1000px;
height: 500px;
margin: 0 auto;
display: none;
position: relative;
user-select: none;
cursor: none;
-moz-user-select: none;
-moz-user-drag: none;
}

.memDiv {
border: 0px solid gray;
padding-top: 0px;
padding-bottom: 0px;
padding-right: 0px;
padding-left: 0px;
width: 1000px;
height: 500px;
margin: 0 auto;
display: none;
cursor: none;
user-select: none;
-moz-user-select: none;
-moz-user-drag: none;
}


.fix {
width: 25px;
position: absolute;
top: 250px;
left: 500px;
margin-top: -8px;
margin-left: -8px; 
position: relative; 
cursor: pointer;
}

.cue{
width: 100px;
position: absolute;
margin-top: -50px;
margin-left: -50px;
cursor: none;
}

.cuefix {
width: 25px;
position: absolute;
top: 250px;
left: 500px;
margin-top: -8px;
margin-left: -8px; 
position: relative; 
}

.mem {
width: 25px;
position: absolute;
top: 250px;
left: 500px;
margin-top: -8px;
margin-left: -8px; 
position: relative; 
}

.choice1 {
width: 100px;
position: absolute;
margin-top: -50px;
margin-left: -50px;
}

.choice2 {
width: 100px;
position: absolute;
margin-top: -50px;
margin-left: -50px;
}

.choice3 {
width: 100px;
position: absolute;
margin-top: -50px;
margin-left: -50px;
}

.choice4 {
width: 100px;
position: absolute;
margin-top: -50px;
margin-left: -50px;
}


.titleDiv {
display: none;
padding: 5px;
text-align: center;
}

.progressDiv {
display: none;
padding: 5px;
text-align: center;
}

.NextStimuliDiv {
border: 0px solid gray;
padding-top: 0px;
padding-bottom: 0px;
padding-right: 0px;
padding-left: 0px;
width: 1000px;
height: 500px;
margin: 0 auto;
display: none;
}

.NextImages{
float:left;
display:none;
width: 100px;
}

body {
font-family: Arial, Helvetica;
font-size: 12pt;
}

#statistics {
display: none;
}

#instructions {
width: 850px;
margin: 0 auto;
text-align: center;
margin-top: 50px;
}


#startExperiment {
color: rgb(200,200,200);
text-decoration: none;
}

#startExperiment:hover {
color: white;
}

#startExperimentButton {
width: 200px;
text-align: center;
border: 4px outset gray;
background: gray;
padding: 5px;
margin: 0 auto;
}

#submitButton {
display: none;
text-align: center;
font-size: 24px;
/*margin: 300 600 auto;*/
}

}
</style>

<body style="background-color:rgb(188, 188, 187)">
</body>

<div id="instructions">
<p>Please <b> take your time </b> to read these instructions!.&nbsp;</p>
<!-- 
<p>You can repeat this HIT as many times as you would like.</p>
 -->

<p>&nbsp;</p>
<p><strong>Instructions </strong></p>
<p>In each round, you will be shown one colored circle (the "cue"), followed by 4 colored circles (the "choices"). 
Your job is to pick the choice that is the same color as the cue you just saw.</p>
<p> To begin each round, click on the cross in the center of the screen. Keep your cursor in the center until the 
choices appear and you are ready to click on your selection. 
<b>Respond as quickly and accurately as you can</b>.</p>
<p> Please turn off any light filters you have on your computer (ex: Night Light, Flux), as these filters will distort the colors. 
You may find it easiest to do this task in fullscreen mode.</p>
<p>Each round usually takes 3-5 seconds. There are <b> 400 rounds </b>. You can easily complete this 
task in about 20 minutes, if you pay attention and work quickly. You will receive $4.00 for performing the task reasonably.
<b>If you just click colors randomly, you will not receive payment</b>.  This is a very simple task.</p>
<p>You are welcome to do this HIT (or any of our others) as many times as you like! Replication is a good thing.</p>
<p>&nbsp;</p>

<div id="startExperimentButton"><a href="#" id="startExperiment">Start HIT </a></div>

<p>&nbsp;</p>
</div>

<!-- declare input variables for participants and those that we provide-->


<!--  ************************************************************************
************************************************************************
************************************************************************
Stuff that gets sent back to MTurk   -----------------------------
************************************************************************
************************************************************************
************************************************************************
-->

<p>
<input id="inputIndex" name="inputIdx" type="hidden" value="" />
<input id="cue" name="CueImageIndex" type="hidden" value="" />
<input id="choice1" name="Choice1ImageIndex" type="hidden" value="" />
<input id="choice2" name="Choice2ImageIndex" type="hidden" value="" />
<input id="choice3" name="Choice3ImageIndex" type="hidden" value="" />
<input id="choice4" name="Choice4ImageIndex" type="hidden" value="" />
<input id="choice1Theta" name="Choice1ThetaVal" type="hidden" value="" />
<input id="choice2Theta" name="Choice2ThetaVal" type="hidden" value="" />
<input id="choice3Theta" name="Choice3ThetaVal" type="hidden" value="" />
<input id="choice4Theta" name="Choice4ThetaVal" type="hidden" value="" />
<input class="choice" name="answer" type="hidden" value="" />
<input id="reactionTime" name="RT" type="hidden" value="" />
<input id="experimentDuration" name="expDuration" type="hidden" value="" />
</p>



<div class="titleDiv"><b>Pick the option which best matches the original color. </b></div>
<div class="progressDiv"><span id="trialString">Trial </span></div>
<!--  ************************************************************************
Images to show   -----------------------------
************************************************************************
-->

<div class='fixDiv' id='fix'>
<img draggable="false" class="fix" id="fiximage" src="" />  
<p style="clear: both;">&nbsp;</p>
</div>

<div class='memDiv' id='mem'>
<img draggable="false" class="mem" id="memimage" src="" />  
<p style="clear: both;">&nbsp;</p>
</div>

<div class='cueDiv' id='cue'>
<img draggable="false" class="cuefix" id="cuefiximage" src="" />  
<img draggable="false" class="cue" id="cueimage" src="" />
<p style="clear: both;">&nbsp;</p>
</div>

<div class="trialDiv" id="trial">
<p><!-- the first id is for the link, the second for the image -->
<a class="response" href="#" id="idx1"> <img draggable="false" class="choice1" id="Choice1Image" src="" /> </a> 
<a class="response" href="#" id="idx2"> <img draggable="false" class="choice2" id="Choice2Image" src="" /> </a>
<a class="response" href="#" id="idx3"> <img draggable="false" class="choice3" id="Choice3Image" src="" /> </a>
<a class="response" href="#" id="idx4"> <img draggable="false" class="choice4" id="Choice4Image" src="" /> </a>
</p>

<p style="clear: both;">&nbsp;</p>
</div>


<p style="clear: both;">&nbsp;</p>
</div>

<div class="nextStimuliDiv" id="nexttrial">
<img class="NextImages" id="nextCueImage" src="" />
<img class="NextImages" id="nextChoice1Image" src="" />
<img class="NextImages" id="nextChoice2Image" src="" />
<img class="NextImages" id="nextChoice3Image" src="" />
<img class="NextImages" id="nextChoice4Image" src="" />
<p style="clear: both;">&nbsp;</p>
</div>

<!--  ************************************************************************
************************************************************************
************************************************************************
Optional personal info   -----------------------------
************************************************************************
************************************************************************
************************************************************************
-->
<div id="statistics">
<h4 style = "margin-bottom:0.25em"> What browser did you use to complete this HIT?: </h4>
&nbsp; &nbsp; &nbsp; &nbsp; <input name="browser" type="radio" value="Chrome" /> Chrome <br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="browser" type="radio" value="Firefox" /> Firefox <br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="browser" type="radio" value="MicrosoftEdge" /> Microsoft Edge<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="browser" type="radio" value="Safari" /> Safari<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="browser" type="radio" value="Other" /> Other <br />
<h4 style = "margin-bottom:0.25em">Personal Information</h4>
If this is your first time doing this HIT, please fill out this information, otherwise you can leave it blank. <br />
Gender: <input name="gender" type="radio" value="male" /> Male <input name="gender" type="radio" value="female" /> Female <input name="gender" type="radio" value="other" /> Other<br />
Are you Hispanic or Latino?<br />
&nbsp;&nbsp;&nbsp;&nbsp; <input name="hispanic" type="radio" value="Yes" /> Yes<br />
&nbsp;&nbsp;&nbsp;&nbsp; <input name="hispanic" type="radio" value="No" /> No<br />
&nbsp;&nbsp;&nbsp;&nbsp; <input name="hispanic" type="radio" value="N/A" /> Prefer not to answer<br />
Select one or more of the following races that apply to you:<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="race" type="checkbox" value="American Indian" /> American Indian/Alaskan Native<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="race" type="checkbox" value="Asian" /> Asian<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="race" type="checkbox" value="Pacific Islander" /> Native Hawaiian or Other Pacific Islander<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="race" type="checkbox" value="African American" /> Black or African American<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="race" type="checkbox" value="White" /> White<br />
&nbsp; &nbsp; &nbsp; &nbsp; <input name="race" type="checkbox" value="N/A>" /> Prefer Not to Answer<br />
&nbsp;</div>


<script>

var curTrial = 1; // initialize state of trial (nb: JQuery counts from 0 normally)
var startTrialTime; // time the trial starts
var startExpTime = new Date();

const allStimuli = Array.from({length: 64}, (_, index) => index + 1); // all stimuli from 1:64
var trialHash = new Array(nTrials);
var imageIndex = new Array(5);
var nTrials = 400; // number of trials
var ChoiceSpread = 16; // width of window from which choices are picked

var allchosen; // our main variable: what participant chooses
var all_cue; // 
var all_choice1, all_choice2, all_choice3, allchoice_4; // 
var all_choice1Theta, all_choice2Theta, all_choice3Theta, all_choice4Theta; 
var allRTs; // RT for choice

// function to get random integers for cue
function getCue(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive
}

// function to get random choices and sort them
function getChoices(cueID, allStimuli) {
	var distractors1 = between(cueID-ChoiceSpread, cueID-1);
	var distractors2 = between(cueID+1, cueID + ChoiceSpread); 
	distractors = distractors1.concat(distractors2);
	distractors = distractors.map(v => 1 + (v + 64) % 64); 
	distractors =  shuffle(distractors);
	choices = [cueID, distractors[1], distractors[2], distractors[3]]
	choices.sort( function( a , b){
		if(a > b) return 1;
		if(a < b) return -1;
		return 0;
	});
	return choices;
}

// function to get numbers between A and B (: in Matlab) 
function between(a,b) {
	var arrlen = 1+b-a;
	var arr = Array.from({length: arrlen}, (_, index) => index + 1);
	var arr2 = arr.map(v => v+a - 1);
	return arr2
	}

// shuffling function for picking choice combinations
function shuffle(array) {
    var i = array.length,
        j = 0,
        temp;
    while (i--) {
        j = Math.floor(Math.random() * (i+1));
        // swap randomly chosen element with current element
        temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    return array;
}

// function for generating choice positions (equally distributed, rotates randomly on each trial)
function getChoiceThetas() {
	Offset = 2*Math.PI*Math.random();
	if (Math.random() > 0.5) {
		OrigPos = [0, Math.PI*.5, Math.PI, Math.PI*1.5];
	} else {
		OrigPos = [Math.PI*1.5, Math.PI, Math.PI*.5, 0];
	}
	return ChoiceThetas = OrigPos.map(x => ((x + Offset) % (2*Math.PI)));
}

// pol2cart function
function pol2cart(radius, theta, fixX, fixY) {
	x = fixX + (radius * Math.cos(theta));
	y = fixY + (radius * Math.sin(theta));
	return [x,y];
}


// in the id startExperiment, when a click happens on the button show the first trial
$('#startExperiment').click(FirstTrial);
// in the class response, when a click happens on one of the images execute transition to next trial
$('.response').click(choiceClicked);
// clicking fixation goes to next bit
$('.fix').click(DisplayStimuli);

// separate function for first trial
function FirstTrial() {
	cueID = getCue(1,65);
	choices = getChoices(cueID, allStimuli);

	choice1 = choices[0];
	choice2 = choices[1];
	choice3 = choices[2];
	choice4 = choices[3];

	// URLs for current trial
	fixURL = imageNameFromIndex(0);
	currCueURL = imageNameFromIndex(cueID);
	currChoice1URL = imageNameFromIndex(choice1);
	currChoice2URL = imageNameFromIndex(choice2);
	currChoice3URL = imageNameFromIndex(choice3);
	currChoice4URL = imageNameFromIndex(choice4);

	// $('#trial1').show(); // $ is like calling jQuery
	document.getElementById("fiximage").src = fixURL;
	document.getElementById("memimage").src = fixURL;
	document.getElementById("cuefiximage").src = fixURL;
	document.getElementById("cueimage").src = currCueURL;
	document.getElementById("Choice1Image").src = currChoice1URL;
	document.getElementById("Choice2Image").src = currChoice2URL;
	document.getElementById("Choice3Image").src = currChoice3URL;
	document.getElementById("Choice4Image").src = currChoice4URL;
	document.getElementById("trialString").innerHTML = ("   Trial " + curTrial + "/" + nTrials);

	// cue position (because it's not centering for some reason)
	document.getElementById("cueimage").style = "position: absolute; left: 425; top: 200;"; 
	
	// choice positions
	ChoiceThetas = getChoiceThetas();
	choice1Pos = pol2cart(200, ChoiceThetas[0], 500, 250);
	document.getElementById("Choice1Image").style = ("position: absolute; left: " + choice1Pos[0] + "px; top: " + choice1Pos[1] + "px;");
	choice2Pos = pol2cart(200, ChoiceThetas[1], 500, 250);
	document.getElementById("Choice2Image").style = ("position: absolute; left: " + choice2Pos[0] + "px; top: " + choice2Pos[1] + "px;");
	choice3Pos = pol2cart(200, ChoiceThetas[2], 500, 250);
	document.getElementById("Choice3Image").style = ("position: absolute; left: " + choice3Pos[0] + "px; top: " + choice3Pos[1] + "px;");
	choice4Pos = pol2cart(200, ChoiceThetas[3], 500, 250);
	document.getElementById("Choice4Image").style = ("position: absolute; left: " + choice4Pos[0] + "px; top: " + choice4Pos[1] + "px;");

	$('#startExperiment').hide();
	$('#instructions').hide();
	$('.fixDiv').hide();
	$('.cueDiv').hide();
	$('.memDiv').hide();
	$('.trialDiv').hide();

	// show the title, images, and progress
	$('.titleDiv').show();
	$('.progressDiv').show();
	$('.fixDiv').show();

	// preload next stimuli
	nextCue = getCue(1,65);
	nextchoices = getChoices(nextCue, allStimuli);

	nextchoice1 = nextchoices[0];
	nextchoice2 = nextchoices[1];
	nextchoice3 = nextchoices[2];
	nextchoice4 = nextchoices[3];

	// URLs for next trial
	nextCueURL = imageNameFromIndex(nextCue);
	nextChoice1URL = imageNameFromIndex(nextchoice1);
	nextChoice2URL = imageNameFromIndex(nextchoice2);
	nextChoice3URL = imageNameFromIndex(nextchoice3);
	nextChoice4URL = imageNameFromIndex(nextchoice4);

	// $('#trial1').show(); // $ is like calling jQuery
	document.getElementById("nextCueImage").src = nextCueURL;
	document.getElementById("nextChoice1Image").src = nextChoice1URL;
	document.getElementById("nextChoice2Image").src = nextChoice2URL;
	document.getElementById("nextChoice3Image").src = nextChoice3URL;
	document.getElementById("nextChoice4Image").src = nextChoice4URL;	
}

function DisplayStimuli() {
	startTrialTime = new Date();
	
	$('.fixDiv').hide();
	$('.memDiv').show(); // .memDiv is not sensitive to clicking, unlike .fixDiv
	$('.cueDiv').show();
	$('.memDiv').hide();
	setTimeout(function() {
		$('.cueDiv').hide();
		$('.memDiv').show();
		setTimeout(function() {
			$('.trialDiv').show();
			$('.memDiv').hide();
		}, 1500); // memory length
	}, 750); // cue length
}


// when a participant has made a choice, move on to next trial or to submit button
function choiceClicked() {
	var curTime = new Date();
	var rt = curTime - startTrialTime;
	var cur = $(this).attr('id');
	

	if (curTrial == 1) { // if first trial initialize variables
		allchosen = cur;
		allRTs = rt;
		
		all_cue = cueID;
		all_choice1 = choice1;
		all_choice2 = choice2;
		all_choice3 = choice3;
		all_choice4 = choice4;

		all_choice1Theta = ChoiceThetas[0];
		all_choice2Theta = ChoiceThetas[1];
		all_choice3Theta = ChoiceThetas[2];
		all_choice4Theta = ChoiceThetas[3];

	} else {
		allchosen = allchosen + " " + cur; // append blank-separated
		allRTs = allRTs + " " + rt; // append blank-separated
		
		all_cue = all_cue + " " + cueID; // append blank-separated
		all_choice1 = all_choice1 + " " + choice1; // append blank-separated
		all_choice2 = all_choice2 + " " + choice2; // append blank-separated
		all_choice3 = all_choice3 + " " + choice3; // append blank-separated
		all_choice4 = all_choice4 + " " + choice4; // append blank-separated

		all_choice1Theta = all_choice1Theta + " " + ChoiceThetas[0];
		all_choice2Theta = all_choice2Theta + " " + ChoiceThetas[1];
		all_choice3Theta = all_choice3Theta + " " + ChoiceThetas[2];
		all_choice4Theta = all_choice4Theta + " " + ChoiceThetas[3];
	}
	
	NextTrial();
}

// advance to next trial
function NextTrial() {
	curTrial++;
	if (curTrial > nTrials) {
		var endTime = new Date();
		$('.trialDiv').hide();
		$('.titleDiv').hide();
		document.getElementById("trialString").innerHTML = ("Thank you for participating! Please answer the following questions, then click submit to complete the HIT.");
		$('#statistics').show();
		$('#submitButton').show();
		$("input[type='hidden'][name='expDuration']").val(endTime-startExpTime)
		$("input[type='hidden'][name='answer']").val(allchosen) //  here we add the value to input
		$("input[type='hidden'][name='RT']").val(allRTs) // here we add the value to input
		$("input[type='hidden'][name='CueImageIndex']").val(all_cue) // here we add the value to input
		$("input[type='hidden'][name='Choice1ImageIndex']").val(all_choice1) // here we add the value to input
		$("input[type='hidden'][name='Choice2ImageIndex']").val(all_choice2) // here we add the value to input
		$("input[type='hidden'][name='Choice3ImageIndex']").val(all_choice3) // here we add the value to input
		$("input[type='hidden'][name='Choice4ImageIndex']").val(all_choice4) // here we add the value to input
		$("input[type='hidden'][name='Choice1ThetaVal']").val(all_choice1Theta) // here we add the value to input
		$("input[type='hidden'][name='Choice2ThetaVal']").val(all_choice2Theta) // here we add the value to input
		$("input[type='hidden'][name='Choice3ThetaVal']").val(all_choice3Theta) // here we add the value to input
		$("input[type='hidden'][name='Choice4ThetaVal']").val(all_choice4Theta) // here we add the value to input
	} else {

	//  Code below duplicates much of showFirstTrial() - without the spacial case
		
		var fix = imageNameFromIndex(0);
		cueID = nextCue;
		choices = nextchoices;

		choice1 = choices[0];
		choice2 = choices[1];
		choice3 = choices[2];
		choice4 = choices[3];

		// $('#trial1').show(); // $ is like calling jQuery
		document.getElementById("cueimage").src = document.getElementById("nextCueImage").src;
		document.getElementById("Choice1Image").src = document.getElementById("nextChoice1Image").src;
		document.getElementById("Choice2Image").src = document.getElementById("nextChoice2Image").src;
		document.getElementById("Choice3Image").src = document.getElementById("nextChoice3Image").src;
		document.getElementById("Choice4Image").src = document.getElementById("nextChoice4Image").src;

		document.getElementById("trialString").innerHTML = ("   Trial " + curTrial + "/" + nTrials);

		// choice positions
		ChoiceThetas = getChoiceThetas();
		choice1Pos = pol2cart(200, ChoiceThetas[0], 500, 250);
		document.getElementById("Choice1Image").style = ("position: absolute; left: " + choice1Pos[0] + "px; top: " + choice1Pos[1] + "px;");
		choice2Pos = pol2cart(200, ChoiceThetas[1], 500, 250);
		document.getElementById("Choice2Image").style = ("position: absolute; left: " + choice2Pos[0] + "px; top: " + choice2Pos[1] + "px;");
		choice3Pos = pol2cart(200, ChoiceThetas[2], 500, 250);
		document.getElementById("Choice3Image").style = ("position: absolute; left: " + choice3Pos[0] + "px; top: " + choice3Pos[1] + "px;");
		choice4Pos = pol2cart(200, ChoiceThetas[3], 500, 250);
		document.getElementById("Choice4Image").style = ("position: absolute; left: " + choice4Pos[0] + "px; top: " + choice4Pos[1] + "px;");

		$('.fixDiv').hide();
		$('.cueDiv').hide();
		$('.memDiv').hide();
		$('.trialDiv').hide();
		
		// show the title, images, and progress

		$('.titleDiv').show();
		$('.progressDiv').show();
		$('.fixDiv').show();

		}
		
	if (curTrial + 1 <= nTrials) {
		// preload next stimuli
		nextCue = getCue(1,65);
		nextchoices = getChoices(nextCue, allStimuli);

		nextchoice1 = nextchoices[0];
		nextchoice2 = nextchoices[1];
		nextchoice3 = nextchoices[2];
		nextchoice4 = nextchoices[3];

		// URLs for next trial
		nextCueURL = imageNameFromIndex(nextCue);
		nextChoice1URL = imageNameFromIndex(nextchoice1);
		nextChoice2URL = imageNameFromIndex(nextchoice2);
		nextChoice3URL = imageNameFromIndex(nextchoice3);
		nextChoice4URL = imageNameFromIndex(nextchoice4);

		// $('#trial1').show(); // $ is like calling jQuery
		document.getElementById("nextCueImage").src = nextCueURL;
		document.getElementById("nextChoice1Image").src = nextChoice1URL;
		document.getElementById("nextChoice2Image").src = nextChoice2URL;
		document.getElementById("nextChoice3Image").src = nextChoice3URL;
		document.getElementById("nextChoice4Image").src = nextChoice4URL;
	}
}

// Where to find each shape image (currently local)
function imageNameFromIndex(index) {
	return "https://tunkfiles.net/Four_AFC_Colors_2/" + index + ".jpeg";
}


</script>

<p><input id="submitButton" type="submit" value="Submit" /></p>